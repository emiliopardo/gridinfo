!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-gridinfo">\n  <button id="ctrlTest" class="g-cartografia-bandera" title="AddFeature"></button>\n</div>\n'},function(e){e.exports=JSON.parse('{"url":{"name":"Gridinfo","separator":"*"},"constructor":"M.plugin.Gridinfo","parameters":[],"files":{"ol":{"scripts":[],"styles":[]}},"metadata":{"uuid_plugin":"","uuid_version_plugin":"","version_ficha_metadatos":"","name":"Gridinfo","description":"Description of the plugin","text":"A full text about plugin","version":"1.0.0","date":"","author":"","org":"","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]},"compatibility":["6.0.0"]}}')},function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(2);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,o){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(o):n.value}})(e,t,o||e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=s(e);if(t){var n=s(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return c(this,o)}}function c(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,M.impl.Control);var t,o,r,c=u(f);function f(){return n(this,f),c.apply(this,arguments)}return t=f,(o=[{key:"addTo",value:function(e,t){a(s(f.prototype),"addTo",this).call(this,e,t)}},{key:"getTarget",value:function(e){return e.getMapImpl().values_.target}}])&&i(t.prototype,o),r&&i(t,r),f}(),p=o(0),d=o.n(p);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,o){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=F(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(o):n.value}})(e,t,o||e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=F(e);if(t){var n=F(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return b(this,o)}}function b(e,t){if(t&&("object"===y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(i,M.Control);var t,o,r,n=h(i);function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),M.utils.isUndefined(f)&&M.exception("La implementación usada no puede crear controles GridinfoControl");var o=new f;return(t=n.call(this,o,"Gridinfo")).config=e,t.wfsUrl=t.config.wfsUrl,t.wmsUrl=t.config.wmsUrl,t.layer=t.config.wfsLayer,t.url=null,t.map_=t.map,t.zoom=t.config.zoom,t.info=t.config.info,t.geoJSON=null,t.popup=null,t.popupInfo=null,t.start=null,t.totalFeatures=null,t.batchsize=100,t.limit=1e3,t.selectedFeature=null,t.getInfoFeature=null,t.getInfoQuery=!1,t.polygonStyle=new M.style.Polygon({fill:{color:"#ffffff",opacity:0},stroke:{color:"#cdcdcd",width:.1}}),t.polygonSelectedStyle=new M.style.Polygon({fill:{color:"#FFFFFF",opacity:0},stroke:{color:"#FFFF00",width:4}}),t.polygonSelectedStyle2=new M.style.Polygon({fill:{color:"#FFFFFF",opacity:0},stroke:{color:"#FF0000",width:4}}),t.vectorLayer=new M.layer.GeoJSON({name:"vectorLayer",source:{crs:{properties:{name:"EPSG:25830"},type:"name"},features:[],type:"FeatureCollection"},extract:!1},{},{renderMode:"image"}),t}return t=i,(o=[{key:"createView",value:function(e){var t=this;return new Promise((function(e,o){var r=M.template.compileSync(d.a);t.addEvents(r),e(r)}))}},{key:"activate",value:function(){v(F(i.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(){v(F(i.prototype),"deactivate",this).call(this)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-gridinfo button")}},{key:"equals",value:function(e){return e instanceof i}},{key:"addEvents",value:function(e){var t,o=this;this.map_.addLayers(this.vectorLayer),this.vectorLayer.on(M.evt.HOVER_FEATURES,(function(e){o.getInfoQuery||(o.selectedFeature=e[0],o.selectedDataShow(e[0]))})),this.vectorLayer.on(M.evt.LEAVE_FEATURES,(function(e){o.getInfoQuery||(e[0].setStyle(o.polygonStyle),o.selectedFeature=null,o.selectedDataHide())})),this.vectorLayer.on(M.evt.SELECT_FEATURES,(function(e){o.getInfoFeature=e[0],o.udpateStyle(o.vectorLayer.getFeatures())})),this.map_.on(M.evt.COMPLETED,(function(){o.map_.getMapImpl().on("moveend",(function(){o.vectorLayer.clear(),o.start=0,o.totalFeatures=0,t=o.map_.getZoom(),o.selectedGrid=o.getLoadedGridWMS(o.map_.getLayers()),t>=o.zoom&&o.selectedGrid&&(o.gridInfoFields=o.setGridFieldInfo(o.selectedGrid),o.fieldsFilter=o.setCQLFieldsFilter(o.gridInfoFields),o.propertyNames=o.setPropertyNames(o.gridInfoFields),o.bbox=o.map_.getBbox(),o.bboxFilter=o.setCQLBboxFiler(o.bbox),o.url=encodeURI(o.wfsUrl+"service=WFS&version=2.0.0&request=GetFeature&typeName="+o.layer+"&CQL_FILTER="+o.fieldsFilter+" AND "+o.bboxFilter+"&propertyName="+o.propertyNames+"&outputFormat=application/json"),o.showLoader("Cargando datos"),o.incrementalLoad(o.vectorLayer,o.url,o.start,o.batchsize,o.totalFeatures,o.limit)),o.udpateStyle(o.vectorLayer.getFeatures())}))})),this.map_.on(M.evt.ADDED_WMS,(function(){o.vectorLayer.clear(),o.start=0,o.totalFeatures=0,t=o.map_.getZoom(),o.selectedGrid=o.getLoadedGridWMS(o.map_.getLayers()),t>=o.zoom&&o.selectedGrid&&(o.gridInfoFields=o.setGridFieldInfo(o.selectedGrid),o.fieldsFilter=o.setCQLFieldsFilter(o.gridInfoFields),o.propertyNames=o.setPropertyNames(o.gridInfoFields),o.bbox=o.map_.getBbox(),o.bboxFilter=o.setCQLBboxFiler(o.bbox),o.url=encodeURI(o.wfsUrl+"service=WFS&version=2.0.0&request=GetFeature&typeName="+o.layer+"&CQL_FILTER="+o.fieldsFilter+" AND "+o.bboxFilter+"&propertyName="+o.propertyNames+"&outputFormat=application/json"),o.showLoader("Cargando datos"),o.incrementalLoad(o.vectorLayer,o.url,o.start,o.batchsize,o.totalFeatures,o.limit))})),this.map_.on(M.evt.CLICK,(function(e){var t=o.getLoadedLayer(o.map_.getLayers());if(o.selectedFeature&&(o.selectedFeature.setStyle(o.polygonStyle),o.getInfoQuery=!0,o.udpateStyle(o.vectorLayer.getFeatures())),t){var r=e.coord,n=e.pixel,i=t.getImpl().url,a=t.name,l=t.options.styles,u=o.map_.getBbox(),c=o.map_.getImpl().map_.getSize(),s=i+"request=GetFeatureInfo&service=WMS&version=1.1.1&layers="+a+"&styles="+l+"&srs=EPSG:25830&format=image/png&bbox="+u.x.min+","+u.y.min+","+u.x.max+","+u.y.max+"&width="+c[0]+"&height="+c[1]+"&query_layers="+a+"&info_format=text/html&feature_count=1&x="+n[0]+"&y="+n[1]+"&exceptions=application/vnd.ogc.se_xml",f={icon:"g-cartografia-pin",title:"Información",content:o.createLoader("Consultando Información").innerHTML};o.popupInfo=new M.Popup({panMapIfOutOfView:!0}),o.popupInfo.addTab(f),o.map_.addPopup(o.popupInfo,[r[0],r[1]]);var p=document.getElementsByClassName("m-body")[0];document.getElementsByClassName("m-popup-closer")[0].addEventListener("click",(function(){o.getInfoFeature=null,o.udpateStyle(o.vectorLayer.getFeatures()),o.getInfoQuery=!1})),M.remote.get(s).then((function(e){var t=e.text;-1!=t.search("<table ")?p.innerHTML=t:(p.innerHTML='<div class="info-msg">No ha seleccionado una celdilla</div>',o.getInfoFeature=null,o.getInfoQuery=!1,setTimeout((function(){o.popupInfo&&o.map_.removePopup(o.popupInfo)}),500)),o.udpateStyle(o.vectorLayer.getFeatures())}))}}))}},{key:"getLoadedLayer",value:function(e){for(var t=null,o=0;o<e.length;o++){var r=e[o];r instanceof M.layer.WMS&&this.isGridLayer(r)&&(t=r)}return t}},{key:"getLoadedGridWMS",value:function(e){for(var t=null,o=0;o<e.length;o++){var r=e[o];r instanceof M.layer.WMS&&this.isGridLayer(r)&&(t=r.options.styles)}return t}},{key:"isGridLayer",value:function(e){for(var t=!1,o=0;o<this.info.length;o++){var r=this.info[o];e.getImpl().url==this.wmsUrl&&e.name==r.wmsLayer&&r.style==e.options.styles&&(t=!0)}return t}},{key:"setGridFieldInfo",value:function(e){var t=!1,o=null;do{for(var r=0;r<this.info.length;r++){var n=this.info[r];n.style==e&&(o=n.fields),r==this.info.length-1&&(t=!0)}}while(!t);return o}},{key:"incrementalLoad",value:function(e,t,o,r,n,i){var a=this;(0==this.totalFeatures||this.vectorLayer.getFeatures().length<this.totalFeatures)&&(this.start+this.batchsize>this.limit&&(this.batchsize=this.limit-this.start),M.remote.get(t+"&STARTINDEX="+this.start+"&COUNT="+this.batchsize).then((function(e){var t=JSON.parse(e.text);a.totalFeatures=t.totalFeatures,a.totalFeatures=void 0===a.limit?t.totalFeatures:Math.min(a.limit,a.totalFeatures);var o=t.features,r=[];o.forEach((function(e){var t=new M.Feature(e.id,e),o=t.getGeometry();o.type="Polygon";var n=o.coordinates[0];o.coordinates=n,t.setGeometry(o),a.getInfoFeature&&t.getId()==a.getInfoFeature.getId()?t.setStyle(a.polygonSelectedStyle2):t.setStyle(a.polygonStyle),r.push(t)})),a.start=a.start+a.batchsize,a.vectorLayer.addFeatures(r),a.vectorLayer.getFeatures().length<a.totalFeatures?a.incrementalLoad(a.vectorLayer,a.url,a.start,a.batchsize,a.totalFeatures,a.limit):a.hideLoader()})))}},{key:"setInfoPopUp",value:function(e){var t=this,o=this.getPolygonCenter(e.getGeometry()),r=o[0],n=o[1],i={icon:"g-cartografia-pin",title:"Información",content:this.setInfoTable(e)};this.popup=new M.Popup({panMapIfOutOfView:!1}),this.popup.addTab(i),setTimeout((function(){t.map_.addPopup(t.popup,[r,n])}),200)}},{key:"getPolygonCenter",value:function(e){var t=e.coordinates[0][0][0],o=e.coordinates[0][0][1];return[(e.coordinates[0][2][0]-t)/2+t,(e.coordinates[0][2][1]-o)/2+o]}},{key:"selectedDataShow",value:function(e){e.setStyle(this.polygonSelectedStyle),this.setInfoPopUp(e)}},{key:"selectedDataHide",value:function(){this.getInfoQuery||this.map_.removePopup(this.popup)}},{key:"setCQLBboxFiler",value:function(e){return"BBOX(geom,"+e.x.min+","+e.y.min+","+e.x.max+","+e.y.max+")"}},{key:"setCQLFieldsFilter",value:function(e){for(var t=null,o=0;o<e.length;o++){var r=e[o];0==o?t=r.field+">"+r.minValue:t+=" AND "+r.field+">"+r.minValue}return t}},{key:"setPropertyNames",value:function(e){for(var t=null,o=0;o<e.length;o++){var r=e[o];0==o?t=r.field:t+=","+r.field}return t+=",geom"}},{key:"setInfoTable",value:function(e){for(var t='<table class="info-table">',o=0;o<this.gridInfoFields.length;o++){var r=this.gridInfoFields[o];t+='<tr><td class="info-popup-key">'+r.title+'</td><td class="info-popup-value">'+e.getAttribute(r.field)+"</td></tr>"}return t+="</table>"}},{key:"udpateStyle",value:function(e){for(var t=0;t<e.length;t++){var o=e[t];this.getInfoFeature&&o.getId()==this.getInfoFeature.getId()?o.setStyle(this.polygonSelectedStyle2):o.setStyle(this.polygonStyle)}}},{key:"createLoader",value:function(e){var t=document.createElement("div");t.setAttribute("id","loader"),t.setAttribute("class","loader");var o=document.createElement("div");o.setAttribute("class","loader-spinner");var r=document.createElement("div");r.setAttribute("class","loader-text");var n=document.createTextNode(e);return r.appendChild(n),t.appendChild(o),t.appendChild(r),t}},{key:"showLoader",value:function(e){var t=this.createLoader(e);document.querySelector("div.m-mapea-container").appendChild(t)}},{key:"hideLoader",value:function(){document.getElementById("loader").remove()}}])&&m(t.prototype,o),r&&m(t,r),i}(),_=o(1);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=x(e);if(t){var n=x(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return P(this,o)}}function P(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(i,M.Plugin);var t,o,r,n=I(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=n.call(this)).map_=null,t.config=e,t.controls_=[],t.metadata_=_.metadata,t}return t=i,(o=[{key:"addTo",value:function(e){var t=this;this.control_=new w(this.config),this.controls_.push(this.control_),this.map_=e,this.panel_=new M.ui.Panel("panelGridinfo",{collapsible:!0,position:M.ui.position.TL,className:"m-gridinfo",collapsedButtonClass:"g-cartografia-info",tooltip:"Consultar Información"}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_),this.control_.on(M.evt.ADDED_TO_MAP,(function(){t.fire(M.evt.ADDED_TO_MAP)}))}},{key:"getMetadata",value:function(){return this.metadata_}}])&&L(t.prototype,o),r&&L(t,r),i}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Gridinfo=E,window.M.control.GridinfoControl=w,window.M.impl.control.GridinfoControl=f}]);
//# sourceMappingURL=gridinfo.ol.min.js.map