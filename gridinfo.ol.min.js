!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-gridinfo">\n  <button id="ctrlTest" class="g-cartografia-bandera" title="AddFeature"></button>\n</div>\n'},function(e){e.exports=JSON.parse('{"url":{"name":"Gridinfo","separator":"*"},"constructor":"M.plugin.Gridinfo","parameters":[],"files":{"ol":{"scripts":[],"styles":[]}},"metadata":{"uuid_plugin":"","uuid_version_plugin":"","version_ficha_metadatos":"","name":"Gridinfo","description":"Description of the plugin","text":"A full text about plugin","version":"1.0.0","date":"","author":"","org":"","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]},"compatibility":["6.0.0"]}}')},function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(2);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,o){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=s(e);if(t){var r=s(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return c(this,o)}}function c(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,M.impl.Control);var t,o,n,c=u(f);function f(){return r(this,f),c.apply(this,arguments)}return t=f,(o=[{key:"addTo",value:function(e,t){a(s(f.prototype),"addTo",this).call(this,e,t)}},{key:"getTarget",value:function(e){return e.getMapImpl().values_.target}}])&&i(t.prototype,o),n&&i(t,n),f}(),p=o(0),y=o.n(p);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,o){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=w(e);if(t){var r=w(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return b(this,o)}}function b(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(i,M.Control);var t,o,n,r=h(i);function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),M.utils.isUndefined(f)&&M.exception("La implementaciÃ³n usada no puede crear controles GridinfoControl");var o=new f;return(t=r.call(this,o,"Gridinfo")).config=e,t.wfsUrl=t.config.wfsUrl,t.wmsUrl=t.config.wmsUrl,t.layer=t.config.wfsLayer,t.url=null,t.map_=t.map,t.zoom=t.config.zoom,t.info=t.config.info,t.geoJSON=null,t.popup=null,t.popupInfo=null,t.start=null,t.totalFeatures=null,t.batchsize=100,t.limit=1e3,t.selectedFeature=null,t.getInfoFeature=null,t.getInfoQuery=!1,t.polygonStyle=new M.style.Polygon({fill:{color:"#ffffff",opacity:0},stroke:{color:"#cdcdcd",width:.1}}),t.polygonSelectedStyle=new M.style.Polygon({fill:{color:"#FFFFFF",opacity:0},stroke:{color:"#FFFF00",width:4}}),t.vectorLayer=new M.layer.GeoJSON({name:"vectorLayer",source:{crs:{properties:{name:"EPSG:25830"},type:"name"},features:[],type:"FeatureCollection"},extract:!1},{},{renderMode:"image"}),t}return t=i,(o=[{key:"createView",value:function(e){var t=this;return new Promise((function(e,o){var n=M.template.compileSync(y.a);t.addEvents(n),e(n)}))}},{key:"activate",value:function(){v(w(i.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(){v(w(i.prototype),"deactivate",this).call(this)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-gridinfo button")}},{key:"equals",value:function(e){return e instanceof i}},{key:"addEvents",value:function(e){var t,o=this;this.map_.addLayers(this.vectorLayer),this.vectorLayer.on(M.evt.HOVER_FEATURES,(function(e){o.getInfoQuery||(o.selectedFeature=e[0],o.selectedDataShow(e[0]))})),this.vectorLayer.on(M.evt.LEAVE_FEATURES,(function(e){o.getInfoQuery||(e[0].setStyle(o.polygonStyle),o.selectedFeature=null,o.selectedDataHide())})),this.vectorLayer.on(M.evt.SELECT_FEATURES,(function(e){o.getInfoFeature=e[0],o.getInfoQuery=!0,e[0].setStyle(o.polygonSelectedStyle),o.selectedFeature=e[0]})),this.map_.on(M.evt.COMPLETED,(function(){o.map_.getMapImpl().on("moveend",(function(){o.start=0,o.totalFeatures=0,t=o.map_.getZoom(),o.selectedGrid=o.getLoadedGridWMS(o.map_.getLayers()),t>=o.zoom&&o.selectedGrid&&(o.gridInfoFields=o.setGridFieldInfo(o.selectedGrid),o.fieldsFilter=o.setCQLFieldsFilter(o.gridInfoFields),o.propertyNames=o.setPropertyNames(o.gridInfoFields),o.bbox=o.map_.getBbox(),o.bboxFilter=o.setCQLBboxFiler(o.bbox),o.url=encodeURI(o.wfsUrl+"service=WFS&version=2.0.0&request=GetFeature&typeName="+o.layer+"&CQL_FILTER="+o.fieldsFilter+" AND "+o.bboxFilter+"&propertyName="+o.propertyNames+"&outputFormat=application/json"),o.incrementalLoad(o.vectorLayer,o.url,o.start,o.batchsize,o.totalFeatures,o.limit))}))})),this.map_.on(M.evt.ADDED_WMS,(function(){o.vectorLayer.clear(),o.start=0,o.totalFeatures=0,t=o.map_.getZoom(),o.selectedGrid=o.getLoadedGridWMS(o.map_.getLayers()),t>=o.zoom&&o.selectedGrid&&(o.gridInfoFields=o.setGridFieldInfo(o.selectedGrid),o.fieldsFilter=o.setCQLFieldsFilter(o.gridInfoFields),o.propertyNames=o.setPropertyNames(o.gridInfoFields),o.bbox=o.map_.getBbox(),o.bboxFilter=o.setCQLBboxFiler(o.bbox),o.url=encodeURI(o.wfsUrl+"service=WFS&version=2.0.0&request=GetFeature&typeName="+o.layer+"&CQL_FILTER="+o.fieldsFilter+" AND "+o.bboxFilter+"&propertyName="+o.propertyNames+"&outputFormat=application/json"),o.incrementalLoad(o.vectorLayer,o.url,o.start,o.batchsize,o.totalFeatures,o.limit))})),this.map_.on(M.evt.CLICK,(function(e){var t=o.getLoadedLayer(o.map_.getLayers());if(o.selectedFeature&&(o.infoFeature=o.selectedFeature,o.infoFeature.setStyle(o.polygonSelectedStyle),o.getInfoQuery=!0),t){var n=e.coord,r=e.pixel,i=t.getImpl().url,a=t.name,l=t.options.styles,u=o.map_.getBbox(),c=o.map_.getImpl().map_.getSize(),s=i+"request=GetFeatureInfo&service=WMS&version=1.1.1&layers="+a+"&styles="+l+"&srs=EPSG:25830&format=image/png&bbox="+u.x.min+","+u.y.min+","+u.x.max+","+u.y.max+"&width="+c[0]+"&height="+c[1]+"&query_layers="+a+"&info_format=text/html&feature_count=1&x="+r[0]+"&y="+r[1]+"&exceptions=application/vnd.ogc.se_xml";M.remote.get(s).then((function(e){var t=e.text;if(-1!=t.search("<table ")){var r={icon:"g-cartografia-pin",title:"InformaciÃ³n",content:t};o.popupInfo=new M.Popup({panMapIfOutOfView:!0}),o.popupInfo.addTab(r),o.map_.addPopup(o.popupInfo,[n[0],n[1]]),document.getElementsByClassName("m-popup-closer")[0].addEventListener("click",(function(){o.getInfoQuery=!1,o.getInfoFeature&&o.getInfoFeature.setStyle(o.polygonStyle)}))}}))}}))}},{key:"getLoadedLayer",value:function(e){for(var t=null,o=0;o<e.length;o++){var n=e[o];n instanceof M.layer.WMS&&this.isGridLayer(n)&&(t=n)}return t}},{key:"getLoadedGridWMS",value:function(e){for(var t=null,o=0;o<e.length;o++){var n=e[o];n instanceof M.layer.WMS&&this.isGridLayer(n)&&(t=n.options.styles)}return t}},{key:"isGridLayer",value:function(e){for(var t=!1,o=0;o<this.info.length;o++){var n=this.info[o];e.getImpl().url==this.wmsUrl&&e.name==n.wmsLayer&&n.style==e.options.styles&&(t=!0)}return t}},{key:"setGridFieldInfo",value:function(e){var t=!1,o=null;do{for(var n=0;n<this.info.length;n++){var r=this.info[n];r.style==e&&(o=r.fields),n==this.info.length-1&&(t=!0)}}while(!t);return o}},{key:"incrementalLoad",value:function(e,t,o,n,r,i){var a=this;(0==this.totalFeatures||this.vectorLayer.getFeatures().length<this.totalFeatures)&&(this.start+this.batchsize>this.limit&&(this.batchsize=this.limit-this.start),M.remote.get(t+"&STARTINDEX="+this.start+"&COUNT="+this.batchsize).then((function(e){var t=JSON.parse(e.text);a.totalFeatures=t.totalFeatures,a.totalFeatures=void 0===a.limit?t.totalFeatures:Math.min(a.limit,a.totalFeatures);var o=t.features,n=[];o.forEach((function(e){var t=new M.Feature(e.id,e),o=t.getGeometry();o.type="Polygon";var r=o.coordinates[0];o.coordinates=r,t.setGeometry(o),t.setStyle(a.polygonStyle),n.push(t)})),a.start=a.start+a.batchsize,a.vectorLayer.addFeatures(n),a.vectorLayer.getFeatures().length<a.totalFeatures&&a.incrementalLoad(a.vectorLayer,a.url,a.start,a.batchsize,a.totalFeatures,a.limit)})))}},{key:"setInfoPopUp",value:function(e){var t=this,o=this.getPolygonCenter(e.getGeometry()),n=o[0],r=o[1],i={icon:"g-cartografia-pin",title:"InformaciÃ³n",content:this.setInfoTable(e)};this.popup=new M.Popup({panMapIfOutOfView:!1}),this.popup.addTab(i),setTimeout((function(){t.map_.addPopup(t.popup,[n,r])}),200)}},{key:"getPolygonCenter",value:function(e){var t=e.coordinates[0][0][0],o=e.coordinates[0][0][1];return[(e.coordinates[0][2][0]-t)/2+t,(e.coordinates[0][2][1]-o)/2+o]}},{key:"selectedDataShow",value:function(e){e.setStyle(this.polygonSelectedStyle),this.setInfoPopUp(e)}},{key:"selectedDataHide",value:function(){this.getInfoQuery||this.map_.removePopup(this.popup)}},{key:"setCQLBboxFiler",value:function(e){return"BBOX(geom,"+e.x.min+","+e.y.min+","+e.x.max+","+e.y.max+")"}},{key:"setCQLFieldsFilter",value:function(e){for(var t=null,o=0;o<e.length;o++){var n=e[o];0==o?t=n.field+">"+n.minValue:t+=" AND "+n.field+">"+n.minValue}return t}},{key:"setPropertyNames",value:function(e){for(var t=null,o=0;o<e.length;o++){var n=e[o];0==o?t=n.field:t+=","+n.field}return t+=",geom"}},{key:"setInfoTable",value:function(e){for(var t='<table class="info-table">',o=0;o<this.gridInfoFields.length;o++){var n=this.gridInfoFields[o];t+='<tr><td class="info-popup-key">'+n.title+'</td><td class="info-popup-value">'+e.getAttribute(n.field)+"</td></tr>"}return t+="</table>"}}])&&m(t.prototype,o),n&&m(t,n),i}(),_=o(1);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=I(e);if(t){var r=I(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return x(this,o)}}function x(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(i,M.Plugin);var t,o,n,r=L(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=r.call(this)).map_=null,t.config=e,t.controls_=[],t.metadata_=_.metadata,t}return t=i,(o=[{key:"addTo",value:function(e){var t=this;this.control_=new F(this.config),this.controls_.push(this.control_),this.map_=e,this.panel_=new M.ui.Panel("panelGridinfo",{collapsible:!0,position:M.ui.position.TL,className:"m-gridinfo",collapsedButtonClass:"g-cartografia-info",tooltip:"Consultar InformaciÃ³n"}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_),this.control_.on(M.evt.ADDED_TO_MAP,(function(){t.fire(M.evt.ADDED_TO_MAP)}))}},{key:"getMetadata",value:function(){return this.metadata_}}])&&O(t.prototype,o),n&&O(t,n),i}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Gridinfo=E,window.M.control.GridinfoControl=F,window.M.impl.control.GridinfoControl=f}]);
//# sourceMappingURL=gridinfo.ol.min.js.map